# シェーダー設定

## 概要

全マテリアル共通の設定です。ここでオフにした機能はシェーダーから除去されます。不要な機能をオフにすることでアバターの容量を削減しつつ、負荷も抑えることができます。また、シェーダー設定には自動スキャン機能があり、後からインポートしたマテリアルに足りない設定があると通知が表示され、不足部分は自動で有効化できます。

<div class="window_info">&#x1f530; lilToonでは極力負荷を抑えられるように一般的に使われない機能はデフォルトでオフになっています。必要に応じて`シェーダー設定`タブから機能を有効化してください。</div>

## オススメの設定方法

1. シェーダー設定を全部をオンにする
2. マテリアルを調整
3. `Assets/lilToon/[Shader] Full scan and auto shader setting`を実行

の流れでマテリアルを設定する方法が設定しやすいかもしれません。また、シェーダーバリエーションのうち`_lil/lilToonMulti`を使用するとシェーダー設定を無視して全部オンの状態で調整できるためこちらもオススメです。

## インポート時に自動スキャンしない・ロック

|名前|説明|
|-|-|
|インポート時に自動スキャンしない|マテリアルやアニメーションをインポートした際にスキャンと自動設定を行わなくなり、ダイアログも表示されなくなります。|
|ロック|設定をロックし変更されない状態にします。インポート時の自動スキャンを含むありとあらゆる変更に対して適用されます。|

## シェーダー設定の項目一覧

### 基本色設定

|名前|説明|
|-|-|
|UVアニメーション&角度|ベースとなるUVのアニメーションを設定できるようになります。このアニメーションは個別にアニメーションできるテクスチャを除き、ほとんどのテクスチャに適用されます。|
|色調補正|メインカラーに設定したテクスチャに対し、色相・彩度・明度・ガンマの調整を行えるようになります。|
|グラデーションマップ|メインカラーに設定したテクスチャに対し、グラデーションマップを用いた色調補正を行えるようになります。|
|メインカラー2nd・3rd|メインカラーに重ねて2・3枚目のテクスチャを描画できるようになります。|
|デカール|メインカラー2nd・3rdをデカールとして扱えるようになります。UV座標に応じてクリッピングしたりUVが左右対称の場合に複製、片側だけの場合に3D空間内でも片側だけに表示したりできます。|
|デカールアニメーション|デカールに対してGIFのようなアニメーションを行えるようになります。|
|レイヤーマスク|メインカラー2nd・3rdに対してマスクを適用し、部分的に表示・非表示が行えるようになります。|
|レイヤーDissolve|メインカラー2nd・3rdに対してDissolve（シーンチェンジのようなアニメーション）を適用できるようになります。|
|ノイズ|Dissolveに対してノイズを加えることでディテールを表現できるようになります。|
|アルファマスク|アルファマスク（白黒の透過設定テクスチャ）を用いて透明度を調整できます。部分的な透過自体はメインカラーに透明度を格納することで行えるため、これは外部シェーダーとの互換性保持用のオプションとなっています。|

|名前|説明|
|-|-|
|影|影を付けられるようになります。|
|影の受け取り|他のオブジェクトからの影を受け取れるようになります。VRChatのようなライティング状況が様々な場合は注意が必要で、影がオフだったり、屋根に隠れてしまい全体が影になったりするケースがあります。|
|ぼかし量マスク|影のぼかし量をマスクテクスチャを用いて部分的にコントロールできるようになります。|
|AOマスク|影の範囲（影になりやすさ）をマスクテクスチャを用いて部分的にコントロールできるようになります。|
|強度マスク|影の強さをマスクテクスチャを用いて部分的にコントロールできるようになります。マスクで黒く塗った部分はメインカラーそのままの色が出ます。|
|影色3|3影を使えるようにします。|
|影色1・2・3テクスチャ|影の色をテクスチャを用いて直接指定し、部分的に影の色を変えることができるようになります。|

|名前|説明|
|-|-|
|発光テクスチャ|発光にテクスチャを指定できるようになります。|
|発光テクスチャ2nd|発光をもう1レイヤー重ねられるようになります。|
|発光テクスチャUV|個別にUVを設定できるようになります。|
|発光テクスチャUVアニメーション|個別にUVアニメーションを設定できるようになります。|
|発光マスク|発光に対してマスクを適用できるようになります。例えばマスクとUVアニメーションを組み合わせて部分的にアニメーションする発光を設定できます。|
|発光マスクUV|マスクに対し個別にUVを設定できるようになります。|
|発光マスクUVアニメーション|マスクに対し個別にUVアニメーションを設定できるようになります。|
|発光グラデーション|グラデーションを用いて発光の色を時間変化させることができます。テクスチャのUVのTilingを0にした上でスクロールさせるのと同じ効果があります。|

### ノーマルマップ・光沢設定

|名前|説明|
|-|-|
|ノーマルマップ|ノーマルマップを設定できるようになります。|
|ノーマルマップ2nd|ノーマルマップを重ねられるようになります。|
|ノーマルマップ2ndマスク|ノーマルマップ2ndに対しマスクテクスチャを適用し部分的に強弱を調整できるようになります。|
|異方性反射|異方性反射（髪の毛や金属のヘアライン加工など）を用いた表現が行えるようになります。異方性反射は`反射`の項目の他に`マットキャップ`に対しても適用できます。|

|名前|説明|
|-|-|
|反射|光沢（ハイライト・スペキュラ）やリフレクション（環境光の反射）を設定できるようになります。|
|滑らかさマスク|PBRでいうSmoothnessをテクスチャで指定できるようになります。|
|金属度マスク|PBRでいうMetallicをテクスチャで指定できるようになります。|
|反射色テクスチャ|反射の色をテクスチャで指定できます。光沢を部分的にマスクしたりなどに使用できます。|

|名前|説明|
|-|-|
|マットキャップ|マットキャップ（光沢や陰影を事前に焼き込んだテクスチャ）を設定できるようになります。|
|マットキャップ2nd|マットキャップを2枚重ねられるようになります。|
|マットキャップマスク|マスクを適用し部分的に適用度を調整できます。|
|カスタムノーマルマップ|個別にノーマルマップを設定できるようになります。|

|名前|説明|
|-|-|
|リムライト|リムライトを設定できるようになります。|
|リムライト色テクスチャ|テクスチャを指定して部分的に色を変えたりマスクしたりできるようになります。|
|ライト方向によるカスタマイズ|ライト方向によって2つのリムライト（日向側・影側）を設定できるようになります。|

|名前|説明|
|-|-|
|ラメ|ラメのようなキラキラした表現を設定できるようになります。|
|逆光ライト|逆光のときにだけ出るリムライトやハイライトのような表現を設定できるようになります。|

### 拡張設定

|名前|説明|
|-|-|
|視差マップ|見る角度に応じてUVをずらし立体感を出せるようになります。|
|[高負荷] POM|`Parallax Occlusion Mapping`という手法を用いて視差マップの精度を高められます。ただし負荷は高めです。|

|名前|説明|
|-|-|
|距離クリッピングキャンセラー|カメラのNear Clipの設定によって近づいたときに消えるのを防ぎます。このオプションはマテリアルに個別に設定する必要なく、シェーダー設定内でオンにすると自動的に全マテリアルでオンになります。また、Near Clipが0.1以上の場合のような意図的に消している場合には動作しないようになっています。|
|距離フェード|カメラからの距離に応じて色を変更できます。近づいたときに暗くするなどの表現ができます。|

|名前|説明|
|-|-|
|AudioLink|[Udon AudioLink](https://github.com/llealloo/vrc-udon-audio-link)という技術を用いてVRChat内でワールドの音に同期したマテリアルのアニメーションを行えるようになります。|
|頂点|AudioLinkによって頂点をアニメーションできるようになります。|
|マスク (R:Delay G:Band B:Strength)|マスクテクスチャでスペクトラムアナライザのようなものを表示できるようになります。|
|ローカル|ワールドに同期せずにローカルで動作するAudioLinkを設定できます。|

|名前|説明|
|-|-|
|Dissolve|Dissolve（シーンチェンジのようなアニメーション）を適用できるようになります。|
|ノイズ|Dissolveに対してノイズを加えることでディテールを表現できるようになります。|

|名前|説明|
|-|-|
|暗号化|[AvaterEncryption](https://github.com/lilxyzw/AvaterEncryption)がインポートされている場合のみに表示されるオプションです。メッシュの暗号化を行えるようになります。|

|名前|説明|
|-|-|
|輪郭線色テクスチャ|輪郭線に対してテクスチャで色を指定できるようになります。|
|輪郭線UVアニメーション|輪郭線のテクスチャでUVをアニメーションさせられます。|
|色調補正|輪郭線の色に色調補正を適用できるようになります。|
|輪郭線太さマスク|輪郭線の太さをマスクテクスチャでコントロールできるようになります。|
|輪郭線ノーマルマップ|輪郭線の描画で使われる法線をノーマルマップを用いてコントロールできるようになります。|

|名前|説明|
|-|-|
|ファーノーマルマップ|ファーの向きをノーマルマップを用いてコントロールできるようになります。|
|ファーマスク|マスクテクスチャで部分的に透明度を下げられるようになります。|
|ファー長さマスク|マスクテクスチャで部分的に長さを調整できるようになります。|
|ファー当たり判定|頂点ライトを用いた擬似的なコライダーによる変形を行えるようになります。|

|名前|説明|
|-|-|
|テッセレーション (非常に高負荷)|テッセレーションを用いて距離に応じた自動ハイポリ化を行えます。ただし非常に高負荷であり、映像制作など非リアルタイム環境向けです。|

## ビルドサイズの最適化
各項目をオフにすることでビルドサイズを削減できます。VRChatであればアバター容量・ワールド容量の削減になります。

|名前|説明|
|-|-|
|ForwardAddパスで影を有効化|ForwardAddパス（Point Light・Spot Light）に対しても影が適用されるようになります。|
|ForwardAddパスを使用|ForwardAddパスを使用するようになります。これがオフの場合は代わりに頂点ライトにライトが渡されるようになります。ただしこれは描画に大きく影響するため基本的にオン推奨です。|
|頂点ライトを使用|頂点ライト（頂点単位で計算される簡易的なライト）を使用するようになります。|
|ライトマップを使用|ライトマップを使用するようになります。VRChatなどのアバター用途では不要です（ワールド専用）。|

## 初期値
`GameObject/lilToon/[GameObject] Fix lighting`やライティングプリセットに使用される値です。各パラメータの詳細については[ライティング設定](/ja-jp/base/lighting)を参照してください、

|名前|デフォルト|
|-|-|
|Unlit化|0|
|頂点ライトの強度|0|
|明るさの下限|0.05|
|明るさの上限|1|
|ライトのモノクロ化|0|
|ライト方向のオーバーライド|X:0、Y:0.001、Z:0、W:0|
|[HDRP] Before exposure limit|10000|
|[HDRP] Directional Lightの強さ|1|

## 初期設定
初期設定では影、強度マスク、発光テクスチャ、ノーマルマップ、マットキャップ、マットキャップマスク、リムライト、リムライト色テクスチャ、輪郭線色テクスチャ、輪郭線太さマップがオンになっています。